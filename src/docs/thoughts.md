目前看起来, 微服务架构是最好的做法. Shell 是一个独立的端, 而 Ghost 是一个独立的服务.
最好在技术上也能够把两者合并到一起.
Ghost 本身是单一通道, 则可以在没有 Shell 的情况下, 独立地运行.
当然也可以把两者合并, 做成单一的服务端实例. 这是目前的目标.

* Chatbot架构

----

Shell 和 Client 的通讯有几种情况: 同步 / 双工 / 异步.
具体实现, Shell 不应该管那么死. 而应该抽象为两种:

1. 被动发送消息给用户, 用户有请求时
2. 主动发送消息给用户.

主动发送存在两种情况, 则是双工或离线. 这个应该让 Shell 的 Server 自己去判断.
基于这种思路, 目前的 Shell 又 xx 需要重做.

* Shell通讯.

----

Shell 会从 Ghost 拿到同步结果, 还要能拿到异步结果.
很明显这个异步结果是通过管道来获取的.
至于 Shell 在什么地方去获取, 用在什么地方, 就是另一回事了.

* Ghost通讯

----

Shell 通讯模型应该做规范化.
目前的思路是, Shell 和 Ghost 通讯有同步和异步两种, 同时起作用.
Ghost 和 Shell 不建议做双工通讯.
这样 Shell 还得自己维护粘包等逻辑, 做非常复杂的同步协议, 以实现对客户端的同步响应.
如果同步响应是必须的, Ghost 就不能和 Shell 做双工.

* Ghost通讯

----

Shell 和 Client 之间的通讯有三种形式.
同步通信, 双工通讯的主动推送, 离线推送.
离线推送可以理解为一种主动推送, 但区别在于双工场景下,
Server 实例必须知道自己可以推送哪些内容.

* shell通讯

----

Ghost 和 Shell 究竟怎么维护, 现在成了最麻烦的问题.
第一种思路是微服务, Shell 和 Ghost 之间进行同步 + 异步的通讯.
第二种思路则是分布式, 每一个实例同时是 Shell + Ghost, Ghost 保持某种一致性.

* chatbot架构

----

把开发思路整理成特别有序的文章, 又浪费精力, 又把思路给拆散了. 很麻烦.
现在考虑用类似推特的形式. 一想到什么就写成单条记录.
然后自己打上 hashTag, 方便未来整理.

